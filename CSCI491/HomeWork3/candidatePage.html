<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="jquery-1.11.3.js"></script>
</head>
<body>
    <p id="result"></p>
    <form>
        Enter a search term<br>
        Date: <input type="text" id="date" placeholder="xx-xxx-xx"><br>
        City: <input type="text" id="city" placeholder="city"><br>
        <button type="button" onclick="search()">Enter</button>
    </form>

    <p id="searchResult"></p>
</body>

<script>
    var encodedData = window.location.href.split('=')[1];
    var choice = decodeURI(encodedData);
    var test = JSON.parse(localStorage.getItem('info'));
    var total = 0;
    var searchTotal = 0;
    var container = $('#result');

    $(document).ready(function() {
        for (var i = 1; i < test.length; i++){

            var candidateName = test[i].cand_nm;
            candidateName = candidateName.replace(/^"(.*)"$/, '$1');

            if(candidateName == choice) {

                if(test[i].contb_receipt_amt != null){
                    total += parseInt(test[i].contb_receipt_amt) || 0;
                }
            }
        }

        $.ajax({
            url: "candidates.xml",
            type: "GET",
            dataType: "xml",
            success: function (xml) {

                $(xml).find('candidate').each(function(){
                    var name = $(this).find('name').text();

                    if(choice == name){

                        var image = "<img height='200' width='200' id="+name+" src = " + $(this).find('caption').text() + " >";
                        var state = $(this).find('state').text();

                        $(container).append(image, "<br>", name, "<br>", state, "<br>", "Total donations: $" + total, "<br>");
                    }
                });
            }
        })
    });

    function search(){

        var enteredDate = $('#date').val();
        var enteredCity = $('#city').val();

        if (enteredCity != "") {

            for (var i = 1; i < test.length; i++) {

                var candidateName = test[i].cand_nm;
                candidateName = candidateName.replace(/^"(.*)"$/, '$1');

                if (test[i].contbr_city == enteredCity && candidateName == choice) {
                    searchTotal += parseFloat(test[i].contb_receipt_amt) || 0;
                }
            }
            $('#searchResult').html("The total for " + enteredCity + " is $" + searchTotal);

        }else if(enteredDate != ""){

            for (var j = 1; j < test.length; j++){

                candidateName = test[j].cand_nm;
                candidateName = candidateName.replace(/^"(.*)"$/, '$1');

                if(test[j].contb_receipt_dt === enteredDate && candidateName == choice){
                    searchTotal += parseFloat(test[j].contb_receipt_amt) || 0;
                }
            }
            $('#searchResult').html("The total for " + enteredDate + " is $" + searchTotal);
        }
    }
</script>
</html>